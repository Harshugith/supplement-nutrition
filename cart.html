<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cart | Supplement Nutrition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">

<style>
body{margin:0;background:#0e0e0e;color:#fff;font-family:Arial}
a{text-decoration:none;color:#fff}

/* CART BOX */
.cart-box{max-width:950px;margin:120px auto 50px auto;padding:20px}
.empty{text-align:center;margin-top:120px;opacity:.7}

.item{display:flex;gap:16px;background:#151515;padding:14px;border-radius:14px;margin-bottom:14px;align-items:center}
.item img{width:80px;border-radius:10px}
.info h4{margin:0;font-size:16px}
.info p{margin:4px 0;font-size:14px;opacity:.8}
.qty{display:flex;gap:8px;margin-top:6px;align-items:center}
.qty button{width:26px;height:26px;border:none;border-radius:50%;background:#ff5722;color:#fff;cursor:pointer;font-weight:bold}
.remove{margin-left:auto;background:#ff3b3b;border:none;color:#fff;padding:6px 14px;border-radius:20px;cursor:pointer}

.summary,.form,.checkout,.history{display:none}
.summary{background:#111;padding:18px;border-radius:14px;margin-top:20px}
.summary p,.summary h3{display:flex;justify-content:space-between}
.free-gift{margin-top:10px;display:flex;align-items:center;gap:10px;background:#222;padding:10px;border-radius:10px}
.free-gift img{width:60px;border-radius:8px}
.green{color:#00e676}

.form{background:#111;padding:18px;border-radius:14px;margin-top:20px}
.form input,.form textarea{width:100%;padding:10px;border:none;border-radius:10px;margin-bottom:12px}

.checkout{text-align:right;margin-top:20px}
.checkout button{background:#25D366;border:none;padding:14px 30px;color:#fff;border-radius:30px;font-size:15px;cursor:pointer}

.history{background:#111;padding:18px;border-radius:14px;margin-top:30px}
.history-item{display:flex;gap:12px;border-bottom:1px solid #333;padding:12px 0}
.history-item img{width:60px;border-radius:8px}
</style>
</head>
<body>

<nav class="navbar solid">
  <div class="logo">Supplement Nutrition</div>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="products.html">Products</a></li>
    <li><a href="cart.html">Cart üõí</a></li>
  </ul>
</nav>

<div class="cart-box">
<h2>üõí Your Cart</h2>

<div id="empty" class="empty">
  <h2>Cart is empty</h2>
  <p>Please select items</p>
</div>

<div id="items"></div>

<div class="summary">
  <p><span>Subtotal</span><span id="sub">‚Çπ0</span></p>
  <p id="disc" class="green"></p>
  <h3><span>Total</span><span id="total">‚Çπ0</span></h3>

  <div id="giftDiv"></div>
</div>

<div class="form">
  <h3>Customer Details</h3>
  <input id="name" placeholder="Your Name">
  <input id="mobile" placeholder="Mobile Number" type="tel">
  <textarea id="addr" placeholder="Delivery Address"></textarea>
</div>

<div class="checkout">
  <button onclick="order()">Order on WhatsApp</button>
</div>

<div class="history">
  <h3>üìú Order History</h3>
  <div id="historyList"></div>
</div>
</div>

<script>
const WHATSAPP="919336174510";
let cart=JSON.parse(localStorage.getItem("cart"))||[];
let orders=JSON.parse(localStorage.getItem("orders"))||[];

const itemsDiv=document.getElementById("items");
const emptyDiv=document.getElementById("empty");
const subEl=document.getElementById("sub");
const totalEl=document.getElementById("total");
const discEl=document.getElementById("disc");
const nameInput=document.getElementById("name");
const mobileInput=document.getElementById("mobile");
const addrInput=document.getElementById("addr");
const historyList=document.getElementById("historyList");
const giftDiv=document.getElementById("giftDiv");

// AUTO DISCOUNT LOGIC
function autoDiscount(amount){
  let gift=false, off=0;
  if(amount>=5000){off=100;gift=true;}
  else if(amount>=2000){off=100;}
  else if(amount>=1000){off=50;}
  return {off,gift};
}

// RENDER CART
function render(){
  itemsDiv.innerHTML="";
  giftDiv.innerHTML="";
  let sub=0;

  if(cart.length===0){
    emptyDiv.style.display="block";
    document.querySelector(".summary").style.display="none";
    document.querySelector(".form").style.display="none";
    document.querySelector(".checkout").style.display="none";
  }else{
    emptyDiv.style.display="none";
    document.querySelector(".summary").style.display="block";
    document.querySelector(".form").style.display="block";
    document.querySelector(".checkout").style.display="block";
  }

  cart.forEach((p,i)=>{
    sub+=p.price*p.qty;
    itemsDiv.innerHTML+=`
    <div class="item">
      <img src="${p.img}">
      <div class="info">
        <h4>${p.title}</h4>
        <p>‚Çπ${p.price}</p>
        <div class="qty">
          <button onclick="q(${i},-1)">‚àí</button>
          <span>${p.qty}</span>
          <button onclick="q(${i},1)">+</button>
        </div>
      </div>
      <button class="remove" onclick="rem(${i})">Remove</button>
    </div>`;
  });

  const d=autoDiscount(sub);
  subEl.innerText="‚Çπ"+sub;
  discEl.innerText=d.off?`Discount - ‚Çπ${d.off}`:"";
  totalEl.innerText="‚Çπ"+(sub-d.off);

  if(d.gift){
    giftDiv.innerHTML=`
      <div class="free-gift">
        <img src="images/shaker.png">
        <span>üéÅ Free Shaker on shopping above ‚Çπ5000</span>
      </div>`;
  }
}

// CART ACTIONS
function q(i,v){cart[i].qty+=v;if(cart[i].qty<=0)cart.splice(i,1);save();}
function rem(i){cart.splice(i,1);save();}
function save(){localStorage.setItem("cart",JSON.stringify(cart));render();}

// ORDER
function order(){
  if(cart.length===0){alert("Please select items");return;}
  if(!nameInput.value || !mobileInput.value || !addrInput.value){
    alert("Please fill Name, Mobile & Address");return;
  }

  let sub=0;
  let msg=`üõí *New Order*\n\n`;
  msg+=`üë§ Name: ${nameInput.value}\n`;
  msg+=`üìû Mobile: ${mobileInput.value}\n`;
  msg+=`üè† Address: ${addrInput.value}\n\n`;

  cart.forEach(p=>{
    sub+=p.price*p.qty;
    msg+=`${p.title} x ${p.qty} = ‚Çπ${p.price*p.qty}\n`;
  });

  const d=autoDiscount(sub);
  msg+=`\nSubtotal: ‚Çπ${sub}\nDiscount: ‚Çπ${d.off}\nTotal: ‚Çπ${sub-d.off}`;
  if(d.gift) msg+=`\nüéÅ Free Shaker Included`;

  orders.unshift({date:new Date().toLocaleString(),items:cart,total:sub-d.off,gift:d.gift});
  localStorage.setItem("orders",JSON.stringify(orders));

  cart=[];localStorage.removeItem("cart");
  render();renderHistory();

  window.location.href=`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
}

// HISTORY
function renderHistory(){
  if(orders.length===0)return;
  document.querySelector(".history").style.display="block";
  historyList.innerHTML="";
  orders.forEach(o=>{
    o.items.forEach(p=>{
      historyList.innerHTML+=`
      <div class="history-item">
        <img src="${p.img}">
        <div>
          <strong>${p.title}</strong><br>
          Qty: ${p.qty}<br>
          ‚Çπ${p.price*p.qty}
        </div>
      </div>`;
    });
    if(o.gift){
      historyList.innerHTML+=`
      <div class="free-gift">
        <img src="images/shaker.png">
        <span>üéÅ Free Shaker Included</span>
      </div>`;
    }
  });
}

render();renderHistory();
</script>

</body>
</html>
